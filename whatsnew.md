# What's new in v4 ðŸŽ‰

Version 4 represents a full refactor that has been made to accomodate future changes and challenges. There are technically no breaking-changes, except that some of the new features rely on React being up to date. Among countless of bugfixes and little tweaks and additions, these are the major changes:

## HTML overlays

Attaching dom content to 3d surfaces is hard, in threejs there are a couple of helpers like CSS2D/3D-Renderer, but you are still supposed to create dom nodes imperatively via createElement. Using the new `<Dom/>` primitive you can throw dom content right into the scene graph. It will automatically track its position and follow along.

<p align="middle">
  <img width="100%" src="https://i.imgur.com/fz0vqAO.gif" />
</p>

```jsx
import { Dom } from 'react-three-fiber'

<group position={[100, 10, 0]}>
  <Dom>
    <h1>hello</h2>
  </Dom>
  <mesh>
    <sphereBufferGeometry attach="geometry" />
  </mesh>
</group>
```

## Concurrent mode *experimental*

React-three-fiber can opt into reacts new concurrent/async mode. React will render asynchroneously from then on. It will try to keep a steady 60fps loop at all cost, it will schedule, defer or virtualize operations that threaten to blow the budget.

<p align="middle">
  <img width="100%" src="https://i.imgur.com/KXtHTLH.gif" />
</p>

## Suspense

With Reacts suspense you can manage async assets, which makes it very easy to create loaders or fallback mechanisms.

<p align="middle">
  <img width="100%" src="https://i.imgur.com/Bsap961.gif" />
</p>

## Autogenerated /components for better typing

Typescript treats JSX as a DSL for the dom. Custom reconcilers aren't considered and this has caused some typing problems in the past, especially with elements that exist in both the dom and the threejs namespace, like audio and line. You can now opt out of native elements altogether. 

```jsx
import { Mesh, TorusKnotGeometry, MeshBasicMaterial } 'react-three-fiber/components'

function TorusKnot() {
  return (
    <Mesh>
      <TorusKnotGeometry attach="geometry" args={[10, 3, 100, 16]} />
      <MeshBasicMaterial attach="material" color="hotpink" />
    </Mesh>
  )
}
```

## dispose={null} to switch off recursive asset disposal

If you are working with loaded assets (useLoader or THREE.Loader) you may have noticed that unmounting breaks these assets because react-three-fiber calls `.dispose()` on all objects that unmount. You can now control recursive disposal yourself, that way you can keep assets alive over route changes.

```jsx
<group dispose={null}>
  <mesh />
  <group>
    <mesh />
  <group>
<group>
```

## x-platform architecture (with targets for react-native, css2d, css3d and svg)

The codebase has been refactored to make creating specific target renderers easier.

<p align="middle">
  <img width="100%" src="https://i.imgur.com/hiHMAu8.gif" />
</p>

```jsx
import { Canvas, extend, useFrame, useThree } from "react-three-fiber/svg"

ReactDOM.render(
  <Canvas style={{ background: "#272730" }} camera={{ position: [0, 0, 50] }}>
    <mesh>
      <torusKnotGeometry attach="geometry" args={[10, 3, 100, 16]} />
      <meshBasicMaterial attach="material" color="hotpink" />
    </mesh>
  </Canvas>,
  document.getElementById("root")
)
```
